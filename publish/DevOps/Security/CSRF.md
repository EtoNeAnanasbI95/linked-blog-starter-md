# –ß—Ç–æ —Ç–∞–∫–æ–µ CSRF?
**–°–∏—Ç—É–∞—Ü–∏—è –∏–∑ –∂–∏–∑–Ω–∏**:
1. –¢—ã –∑–∞–ª–æ–≥–∏–Ω–∏–ª—Å—è –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–±–∞–Ω–∫. –£ —Ç–µ–±—è –µ—Å—Ç—å **cookie** ‚Üí –±—Ä–∞—É–∑–µ—Ä —Ö—Ä–∞–Ω–∏—Ç –µ—ë –∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –≤ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ –±–∞–Ω–∫—É.
2. –¢—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –æ—Ç–∫—Ä—ã–ª –∫–∞–∫–æ–π-—Ç–æ –ª–µ–≤—ã—Ö —Å–∞–π—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `evil.com`).
3. –¢–∞–º —Å–ø—Ä—è—Ç–∞–Ω –∫–æ–¥:
```html
<form action="https://bank.com/transfer" method="POST">
  <input type="hidden" name="to" value="hacker123">
  <input type="hidden" name="amount" value="10000">
</form>
<script>document.forms[0].submit();</script>
```
4. –ë—Ä–∞—É–∑–µ—Ä –≤–æ–∑—å–º—ë—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç cookie –±–∞–Ω–∫–∞** (–≤–µ–¥—å –æ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞).
5. –ë–∞–Ω–∫ –¥—É–º–∞–µ—Ç: ¬´–ê–≥–∞, –∑–∞–ø—Ä–æ—Å –ø—Ä–∏—à—ë–ª –æ—Ç –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è¬ª.
6. –ò—Ç–æ–≥ ‚Üí –¥–µ–Ω—å–≥–∏ —É—à–ª–∏.

üëâ –í–æ—Ç —ç—Ç–æ –∏ –µ—Å—Ç—å **CSRF-–∞—Ç–∞–∫–∞**: –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–¥–¥–µ–ª—ã–≤–∞–µ—Ç —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å, –ø–æ–ª—å–∑—É—è—Å—å —Ç–µ–º, —á—Ç–æ –±—Ä–∞—É–∑–µ—Ä **—Å–∞–º** –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç cookie.

**–ù–û cookie  –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–∞–π—Ç–∞ (–¥–æ–º–µ–Ω–∞)**.
–¢–æ –µ—Å—Ç—å, cookie –±–∞–Ω–∫–∞ (`bank.com`) **–Ω–µ —É–π–¥—É—Ç –Ω–∞ `evil.com`**.
–ù–æ —Ñ–æ–∫—É—Å –≤ –¥—Ä—É–≥–æ–º:
- –ö–æ–≥–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å `evil.com` –ø–æ–¥—Å–æ–≤—ã–≤–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä—É —Ñ–æ—Ä–º—É, –≤ –∫–æ—Ç–æ—Ä–æ–π `action="https://bank.com/transfer"`,
- –ë—Ä–∞—É–∑–µ—Ä —Å–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å **–Ω–∞ `bank.com`**,
- –ò —Ä–∞–∑ —ç—Ç–æ –∑–∞–ø—Ä–æ—Å –Ω–∞ `bank.com`, –±—Ä–∞—É–∑–µ—Ä –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç –≤—Å–µ **cookie –¥–ª—è `bank.com`** (–ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ –µ–º—É –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç).

üëâ –í–∞–∂–Ω–æ: –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ **–Ω–µ –≤–∏–¥–∏—Ç —Ç–≤–æ–∏ cookie**. –û–Ω –ø—Ä–æ—Å—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–≤–æ–π –±—Ä–∞—É–∑–µ—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –±–∞–Ω–∫, –∞ –±—Ä–∞—É–∑–µ—Ä —á–µ—Å—Ç–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω—É–∂–Ω—ã–µ cookie, –∫–∞–∫ –±—É–¥—Ç–æ —Ç—ã —Å–∞–º –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª.
# –°–ø–æ—Å–æ–±—ã –∑–∞—â–∏—Ç—ã:
## SameSite cookie (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥)
**–ò–¥–µ—è:** —Å–∫–∞–∑–∞—Ç—å –±—Ä–∞—É–∑–µ—Ä—É, —á—Ç–æ–±—ã –æ–Ω –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª cookie –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã —Å —á—É–∂–∏—Ö —Å–∞–π—Ç–æ–≤.
- **SameSite=Strict** ‚Äî cookie **–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤–æ–æ–±—â–µ**, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—à—ë–ª —Å –¥—Ä—É–≥–æ–≥–æ —Å–∞–π—Ç–∞.
- **SameSite=Lax** ‚Äî cookie –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ ¬´–æ–ø–∞—Å–Ω—ã–µ¬ª –º–µ—Ç–æ–¥—ã (POST, PUT, DELETE), –Ω–æ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ GET-—Å—Å—ã–ª–∫–∏.
**–ü—Ä–∏–º–µ—Ä:**
```
Set-Cookie: sessionId=abc123; SameSite=Strict; HttpOnly; Secure
```
**–ß—Ç–æ –¥–∞—ë—Ç:**  
–ï—Å–ª–∏ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ø—Ä–æ–±—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å POST-–∑–∞–ø—Ä–æ—Å —Å –¥—Ä—É–≥–æ–≥–æ —Å–∞–π—Ç–∞ ‚Äî cookie –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è, —Å–µ—Ä–≤–µ—Ä –Ω–µ —É–∑–Ω–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ä–≥–Ω—É—Ç.
## CSRF Token (—Ç–æ–∫–µ–Ω)
**–ò–¥–µ—è:** —Å–µ—Ä–≤–µ—Ä –≤—ã–¥–∞—ë—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω.
- React –∏–ª–∏ –ª—é–±–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ–±–∞–≤–ª—è–µ—Ç —ç—Ç–æ—Ç —Ç–æ–∫–µ–Ω –≤ **–∫–∞–∂–¥—ã–π –æ–ø–∞—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å** (POST, PUT, DELETE).
- –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–æ–≤–ø–∞–¥–∞–µ—Ç.
**–ü—Ä–∏–º–µ—Ä:**
1. –°–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É:
```
<meta name="csrf-token" content="qwerty123">
```
2. React –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ –∑–∞–ø—Ä–æ—Å:
```
fetch('/api/delete', {   method: 'POST',   headers: {     'X-CSRF-Token': document.querySelector('meta[name="csrf-token"]').content   },   body: JSON.stringify({id: 42}) });
```
3. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
```
if request.headers.get('X-CSRF-Token') != session.csrf_token:     return "Forbidden", 403
```